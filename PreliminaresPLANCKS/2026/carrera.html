---
layout: null
---
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrera de Popularidad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Nunito', sans-serif; background-color: transparent; }
        h1, h2 { font-family: 'Fredoka One', cursive; }
        .track-surface {
            background-color: #ef4444;
            background-image: repeating-linear-gradient(90deg, transparent, transparent 99px, rgba(255,255,255,0.4) 100px);
            border: 4px solid #b91c1c;
        }
        /* Animaci칩n suave para el movimiento */
        .runner { transition: left 1.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="p-2">

    <div class="max-w-4xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
            
            <!-- PISTA -->
            <div class="lg:col-span-3 shadow-xl rounded-xl overflow-hidden relative">
                <div class="bg-red-800 text-white p-2 flex justify-between items-center px-4 border-b-2 border-red-900 z-10 relative">
                    <span class="font-bold text-sm uppercase tracking-wider">游끠 Carrera de Equipos</span>
                    <span id="global-counter" class="bg-red-900 px-2 py-0.5 rounded text-xs font-mono text-yellow-300 border border-red-700">
                        Cargando...
                    </span>
                </div>

                <div class="track-surface relative p-4 h-[350px] flex flex-col justify-center">
                    <!-- L칤nea de meta decorativa -->
                    <div class="absolute right-8 top-0 bottom-0 w-4 border-r-4 border-white z-0 flex flex-col justify-center items-center">
                        <div class="h-full border-r-2 border-dashed border-white opacity-50"></div>
                        <span class="absolute -bottom-6 text-red-800 font-bold text-xs">META</span>
                    </div>
                    <!-- Contenedor de corredores -->
                    <div id="runners-container" class="relative w-full h-full"></div>
                </div>
            </div>

            <!-- CLASIFICACI칍N (Tabla derecha/abajo) -->
            <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden h-fit">
                <div class="bg-gray-800 p-2 text-white font-bold text-center text-xs uppercase">
                    游늵 Clasificaci칩n
                </div>
                <div class="p-2">
                    <ul id="leaderboard" class="space-y-1 text-sm">
                        <li class="text-center text-gray-400 text-xs italic p-4">Esperando datos...</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CORRECCI칍N AQU칈 ---
            // Usamos ruta relativa simple. Busca 'carrera.json' en la misma carpeta que este HTML.
            const dataUrl = '/PreliminaresPLANCKS/data2026/carrera.json';

            console.log("Iniciando carga de datos desde:", dataUrl);

            fetch(dataUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Datos cargados correctamente:", data);
                    procesarCarrera(data);
                })
                .catch(e => {
                    console.error("Error cr칤tico al cargar:", e);
                    mostrarError(dataUrl, e.message);
                });
        });

        function mostrarError(url, detalle) {
            document.getElementById('leaderboard').innerHTML = 
                `<li class="text-red-500 text-xs text-center p-2 font-bold bg-red-50 rounded border border-red-200">
                    丘멆잺 Error de carga<br>
                    <span class="font-normal text-[10px] text-gray-600">
                        No se pudo leer el archivo de datos.<br>
                        Aseg칰rate de que <code>${url}</code> existe en la misma carpeta.
                    </span>
                </li>`;
            document.getElementById('global-counter').innerText = "Error";
        }

        function procesarCarrera(raceData) {
            // Calcular el total de inscritos sumando todos los equipos
            const grandTotal = raceData.reduce((suma, equipo) => suma + (equipo.inscritos || 0), 0);
            
            document.getElementById('global-counter').innerText = `Total Inscritos: ${grandTotal}`;
            renderRace(raceData, grandTotal);
        }

        function renderRace(data, totalGlobal) {
            const trackContainer = document.getElementById('runners-container');
            const leaderboardContainer = document.getElementById('leaderboard');
            
            let runnersHtml = '';
            let leaderboardData = [];
            
            const totalRunners = data.length;
            // Espacio vertical disponible en porcentaje
            const availableHeight = 85; 
            // Calcular el paso vertical entre corredores
            const step = totalRunners > 1 ? availableHeight / (totalRunners - 1) : 0;

            data.forEach((item, index) => {
                let percentage = 0;
                let ratio = 0;
                
                // Calculamos el porcentaje de avance basado en el total global
                // (O puedes cambiar la l칩gica para que el l칤der siempre est칠 al 90%)
                if (totalGlobal > 0) {
                    ratio = item.inscritos / totalGlobal;
                    // Multiplicamos por un factor (ej: 400) para que se muevan visualmente, 
                    // o lo hacemos relativo al l칤der.
                    // Aqu칤 asumo que queremos llenar la barra hasta el 92% m치x.
                    
                    // OPCI칍N: Hacerlo relativo al L칈DER para que siempre haya alguien cerca de la meta
                    // const maxInscritos = Math.max(...data.map(d => d.inscritos));
                    // percentage = (item.inscritos / maxInscritos) * 90;

                    // OPCI칍N ACTUAL: Relativo al 100% (si es porcentaje de votos)
                     percentage = Math.min(ratio * 100 * 3, 92); // *3 es un factor arbitrario para que avancen m치s r치pido visualmente
                }
                
                const topPos = 5 + (index * step);

                // Renderizamos el corredor (emoji)
                runnersHtml += `
                <div id="runner-${item.id}" 
                     class="runner absolute left-0 flex flex-col items-center z-20 group" 
                     style="top: ${topPos}%; left: ${percentage}%;">
                    <img src="${item.imagen}" 
                         class="h-10 w-10 object-contain drop-shadow-md transform -scale-x-100 transition-transform hover:scale-110"
                         alt="${item.nombre}"
                         onerror="this.src='https://img.icons8.com/emoji/48/000000/question-mark.png'">
                    
                    <!-- Tooltip al pasar el mouse -->
                    <div class="opacity-0 group-hover:opacity-100 absolute -top-8 bg-black text-white text-[10px] px-2 py-1 rounded transition-opacity whitespace-nowrap z-50 pointer-events-none shadow-lg">
                        ${item.nombre}: ${item.inscritos}
                    </div>
                </div>`;

                leaderboardData.push({ ...item, ratio: ratio });
            });

            trackContainer.innerHTML = runnersHtml;

            // Ordenar datos para la tabla de clasificaci칩n
            leaderboardData.sort((a, b) => b.inscritos - a.inscritos);
            
            let tableHtml = '';
            leaderboardData.forEach((item, index) => {
                const rank = index + 1;
                // Calculamos porcentaje real para la barra
                const percentText = totalGlobal > 0 ? Math.round((item.inscritos / totalGlobal) * 100) : 0;
                
                let rowClass = "flex items-center justify-between p-1.5 rounded border-b border-gray-100 last:border-0 hover:bg-gray-50";
                let badgeClass = "bg-gray-100 text-gray-600";
                
                // Resaltar al l칤der (oro)
                if (index === 0 && item.inscritos > 0) {
                    rowClass = "flex items-center justify-between p-1.5 rounded bg-yellow-50 border border-yellow-200 shadow-sm mb-1";
                    badgeClass = "bg-yellow-200 text-yellow-800 font-bold";
                }

                tableHtml += `
                <li class="${rowClass} flex-col items-stretch">
                    <div class="flex justify-between items-center mb-1">
                        <div class="flex items-center">
                            <span class="text-[10px] font-bold text-gray-400 w-4 text-center mr-1">${rank}췈</span>
                            <img src="${item.imagen}" class="w-4 h-4 mr-2 object-contain" onerror="this.style.display='none'">
                            <span class="text-xs font-semibold text-gray-700 truncate max-w-[80px]" title="${item.nombre}">${item.nombre}</span>
                        </div>
                        <span class="text-[10px] px-1.5 rounded ${badgeClass}">${item.inscritos}</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-1 overflow-hidden">
                        <div class="bg-blue-500 h-1 rounded-full transition-all duration-1000" style="width: ${percentText}%"></div>
                    </div>
                </li>`;
            });
            leaderboardContainer.innerHTML = tableHtml;
        }
    </script>
</body>
</html>